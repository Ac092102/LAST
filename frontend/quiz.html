<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geography Quiz</title>
  <style>
    body { font-family: Arial; margin: 30px; }
    .section { display: none; }
    .visible { display: block; }
    .question { margin-bottom: 15px; }
    button { margin-top: 10px; }
  </style>
</head>
<body>

  <div id="login-section" class="section visible">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Enter username"><br>
    <button onclick="login()">Login</button>
  </div>

  <div id="student-info-section" class="section">
    <h2>Student Info</h2>
    <input type="text" id="student-name" placeholder="Full Name"><br>
    <input type="text" id="student-id" placeholder="Student ID"><br>
    <button onclick="startQuiz()">Start Quiz</button>
  </div>

  <div id="quiz-section" class="section">
    <h2>Geography Quiz</h2>
    <form id="quiz-form"></form>
    <button onclick="submitQuiz()">Submit Quiz</button>
  </div>

  <div id="result-section" class="section">
    <h2>Result</h2>
    <p id="result-text"></p>
  </div>

  <div id="admin-section" class="section">
    <h2>Admin Panel</h2>
    <button onclick="loadAdminResults()">Refresh Submissions</button>
    <ul id="admin-results"></ul>
  </div>

  <script>
    const quizData = [
      { q: "1. The capital city of the Philippines is _____.", options: ["Cebu", "Davao", "Manila", "Baguio"], answer: 2 },
      { q: "2. _____ is the largest ocean on Earth.", options: ["Indian Ocean", "Pacific Ocean", "Arctic Ocean", "Atlantic Ocean"], answer: 1 },
      { q: "3. The country known for the Eiffel Tower is _____.", options: ["Italy", "Germany", "France", "Spain"], answer: 2 },
      { q: "4. The continent where Egypt is located is _____.", options: ["Asia", "South America", "Africa", "Europe"], answer: 2 },
      { q: "5. Japan is an island country located in _____.", options: ["Asia", "Europe", "Africa", "Australia"], answer: 0 },
      { q: "6. The North Pole is located in the _____ Ocean.", options: ["Indian", "Atlantic", "Pacific", "Arctic"], answer: 3 },
      { q: "7. _____ is the tallest mountain in the world.", options: ["Mount Fuji", "Mount Everest", "Mount Apo", "Mount Kilimanjaro"], answer: 1 },
      { q: "8. The equator is an _____ line around the Earth.", options: ["vertical", "invisible", "imaginary", "icy"], answer: 2 },
      { q: "9. The Philippines is made up of over _____ islands.", options: ["100", "500", "7,000", "1,000"], answer: 2 },
      { q: "10. _____ is the coldest continent on Earth.", options: ["Asia", "Antarctica", "Europe", "Australia"], answer: 1 }
    ];

    let currentUser = "";

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("visible"));
      document.getElementById(id).classList.add("visible");
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      if (user === "admin") {
        showSection("admin-section");
        loadAdminResults();
      } else if (user) {
        currentUser = user;
        showSection("student-info-section");
      } else {
        alert("Please enter a username");
      }
    }

    function startQuiz() {
      const name = document.getElementById("student-name").value.trim();
      const id = document.getElementById("student-id").value.trim();
      if (!name || !id) return alert("Enter full name and ID");
      currentUser = `${name} (${id})`;
      loadQuiz();
      showSection("quiz-section");
    }

    function loadQuiz() {
      const form = document.getElementById("quiz-form");
      form.innerHTML = "";
      quizData.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `<p>${q.q}</p>` + q.options.map((opt, idx) =>
          `<label><input type="radio" name="q${i}" value="${idx}"> ${opt}</label><br>`
        ).join("");
        form.appendChild(div);
      });
    }

    function submitQuiz() {
      const form = document.getElementById("quiz-form");
      let score = 0;

      quizData.forEach((q, i) => {
        const selected = form.querySelector(`input[name="q${i}"]:checked`);
        if (selected && parseInt(selected.value) === q.answer) score++;
      });

      const total = quizData.length;
      const name = document.getElementById("student-name").value.trim();
      const student_id = document.getElementById("student-id").value.trim();

      document.getElementById("result-text").textContent =
        `${name} scored ${score} out of ${total} (${((score / total) * 100).toFixed(2)}%)`;

      fetch("http://localhost:3000/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, student_id, score, total })
      })
      .then(res => res.json())
      .then(data => console.log(data))
      .catch(err => console.error("Error submitting:", err));

      showSection("result-section");
    }

    function loadAdminResults() {
      fetch("http://localhost:3000/admin/results")
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById("admin-results");
          list.innerHTML = data.map(d => `<li>${d.name} (${d.student_id}) - ${d.score}/${d.total} on ${new Date(d.submitted_at).toLocaleString()}</li>`).join("");
        })
        .catch(err => console.error("Error loading admin data:", err));
    }
  </script>

</body>
</html>
